<!DOCTYPE html>
<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

<link rel="stylesheet" href="./static/semantic/css/semantic.min.css"/>
<link href="./static/asset/prettify.css" rel="stylesheet">
<link href="./static/toc/toc.css" rel="stylesheet">
<link rel="stylesheet" href="./static/parm.css"/>
<link rel="stylesheet" href="./static/asset/sons-of-obsidian.css"/>

<title>评论处理 - Avalon Learning</title>
</head>
<body>



<!-- Navbar
================================================== -->
<div class="navbar">
  <div class="ui small secondary inverted borderless menu">
    
    <a class="active item" href="./index.html">Home</a>
    
    <div class="right menu">
      
        
<div class="item">
  <div class="ui icon input">
    <form id="searchform">
    <input name="q" type="text" placeholder="Search...">
    </form>
  </div>
</div>

      
      <div class="ui dropdown item">
        Select Languages <i class="icon dropdown"></i>
        <div class="menu">
          <!--<a class="item language" href="#" data-lang="en">English</a>-->
          <a class="item language" href="#" data-lang="zh_CN">中文</a>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="ui divided grid">
    <div class="four wide column" id="side-bar">
        <div id="toc" class="content"></div>
    </div> 
    
    <div class="twelve wide column" id="markdown-content">
    
        <div class="chapter-prev chapter-top">
    <a prev-chapter href="./ajax_basic.html"><i class="icon-arrow-left"></i> 使用 Ajax 获取数据</a>
</div>
<div class="chapter-next chapter-top">
    <a next-chapter href="./watch.html">使用 $watch 监视变化 <i class="icon-arrow-right"></i></a>
</div>
        
        <h1 id="title_1">评论处理<a class="anchor" href="#title_1">&para;</a></h1>
<h2 id="title_1-1">需求定义<a class="anchor" href="#title_1-1">&para;</a></h2>
<p>在 sementic-ui 中有好看的评论样式，于是我们从中借鉴，进行简单的改造。</p>
<p>先看一下最终的实现效果</p>
<p><img src="images/comments.png"/>
</p>
<p>上面有评论的总条数，每条评论有：头像，作者，发表时间和内容。然后下面还有一个删 除的文本。最下面是发表回复的文本框，以及提交的按钮。</p>
<p>评论的数据，也将从 json 文件中获取。</p>
<h2 id="title_1-2">json 数据准备<a class="anchor" href="#title_1-2">&para;</a></h2>
<pre class="prettyprint "><code>[{"id":1,"author":"Dog Doggington","date":"2 days ago","content":"I think this is a great idea and i am voting on it","avatar":"./avatar.jpg"},{"id":2,"author":"Pawfin Dog","date":"2 days ago","content":"I think this is a great idea and i am voting on it","avatar":"./avatar2.jpg"},{"id":3,"author":"Dog Doggington","date":"2 days ago","content":"I think this is a great idea and i am voting on it","avatar":"./avatar.jpg"}]</code></pre>

<p>可以看到一条评论是由：</p>
<ul>
<li><code>id</code> 当前评论的数据库 ID, 可以用来进行删除</li>
<li><code>author</code> 作者</li>
<li><code>date</code> 发表日期</li>
<li><code>content</code> 评论内容</li>
<li><code>avatar</code> 头像地址</li>
</ul>
<p>这些元素组成。</p>
<h2 id="title_1-3">页面展示代码<a class="anchor" href="#title_1-3">&para;</a></h2>
<p>直接拿到 sementic-ui 的代码还不太符合我的要求，于是对它进行了必要的减化，最终 代码如下：</p>
<pre class="prettyprint linenums"><code>...
&lt;!-- comments --&gt;
&lt;div class="ui piled blue segment" ms-controller="comments"&gt;
  &lt;h2 class="ui header"&gt;
    &lt;i class="icon inverted circular blue comment"&gt;&lt;/i&gt; Comments {{comments.size()}}
  &lt;/h2&gt;
  &lt;div class="ui comments"&gt;
    &lt;div class="comment" ms-repeat="comments"&gt;
      &lt;a class="avatar"&gt;
        &lt;img ms-src="el.avatar"&gt;
      &lt;/a&gt;
      &lt;div class="content"&gt;
        &lt;a class="author"&gt;{{el.author}}&lt;/a&gt;
        &lt;div class="metadata"&gt;
          &lt;span class="date"&gt;{{el.date}}&lt;/span&gt;
        &lt;/div&gt;
        &lt;div class="text"&gt;
          {{el.content|html}}
        &lt;/div&gt;
        &lt;div class="actions"&gt;
          &lt;a class="delete"&gt;Delete&lt;/a&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;form class="ui reply form"&gt;
      &lt;div class="field"&gt;
        &lt;textarea&gt;&lt;/textarea&gt;
      &lt;/div&gt;
      &lt;div class="ui fluid blue labeled submit icon button"&gt;
        &lt;i class="icon edit"&gt;&lt;/i&gt; Add Reply
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/div&gt;
&lt;/div&gt;
...</code></pre>

<p>这里只有几点要提示：</p>
<ol>
<li>单独定义了一个 <code>ms-controller="comments"</code> ，在一个HTML页面中可以有多个 controller</li>
<li>使用 <code>ms-repeat=comments</code> 来进行数据循环，详细说明在下面</li>
<li>使用 <code>{{comments.size()}}</code> ，这里不使用 <code>comments.length</code> 是因为当数组长度    变化时，只有 <code>size()</code> 会引起页面重新进行渲染。</li>
<li><code>el</code> 是 <code>ms-repeat</code> 自动生成的循环变量</li>
<li><code>ms-src</code> 因为头像的图片地址是要使用变量，所以要将 <code>src</code> 属性改为 <code>ms-src</code></li>
</ol>
<div class="ui info message">
<p>所以在属性中用到 Model 中的变量或使用插值表达式的，都要替換成相应的 <code>ms-</code> 开头 的属性。不要担心， Avalon 提供了足够多的 <code>ms-</code> 属性值供你使用。</p>

</div>
<h2 id="title_1-4">ms-repeat 介绍<a class="anchor" href="#title_1-4">&para;</a></h2>
<p>这里只对 <code>ms-repeat</code> 作简单介绍，详细内容请参见下面的参考文档。</p>
<p><code>ms-repeat</code> 类似于对一个数组进行循环，它放在将要重复生成的元素上，本例中就是 每条评论。这样，当前元素会根据数组的个数重复生成，包括其中的子元素。在循环时会 自动生成一些临时变量，用于DOM模板的处理，如：</p>
<ul>
<li><code>el</code> 这个表示循环变量，即当前正在处理的变量</li>
<li><code>$first</code> 如果是第一个元素，则为 <code>true</code></li>
<li><code>$last</code> 如果是最后一个元素，则为 <code>true</code></li>
<li><code>$index</code> 当前元素的索引值</li>
</ul>
<p>还有其它的一些临时变量，这里不详细描述。我们常用的就是 <code>el</code> 这个对象。</p>
<p>因此在下面，我们看到： <code>el.avatar</code>, <code>{{el.author}}</code>, <code>{{el.date}}</code>, <code>{{el.content|html}}</code> 就不难理解了。它们都是通过当前元素来引用相应的具体的属性。</p>
<h2 id="title_1-5">ms-src 介绍<a class="anchor" href="#title_1-5">&para;</a></h2>
<p>前面已经说过，因为使用了 <code>el.avatar</code> 这个变量，所以属性要使用 <code>ms-src</code> 。</p>
<h2 id="title_1-6">JS 代码<a class="anchor" href="#title_1-6">&para;</a></h2>
<p>下面是完整的 js 代码，包括 Blog 的基本信息展示：</p>
<pre class="prettyprint linenums"><code>...
&lt;script&gt;
var model = avalon.define("blog", function(vm){
    vm.blog = {};
});

var comments = avalon.define("comments", function(vm){
    vm.comments = [];
});

$(function(){
    $.getJSON('blog_info.json').done(function(data){
        model.blog = data;
    });
    $.getJSON('comments.json').done(function(data){
        comments.comments = data;
    });
});
&lt;/script&gt;
...</code></pre>

<p>看到了吗？就这么简单。比原来的内容，増加了：</p>
<ol>
<li>comments Model 的定义，但也只是有一个空数组</li>
<li>増加了使用 <code>$.getJSON()</code> 获得评论数据的处理。这块就是一个简单的赋值，也没什么    多说的。</li>
</ol>
<p>对于评论总条数，我们没有特殊处理，只是使用了 <code>{{comments.size()}}</code> ，这样只要 评论条数变化，界面自动变化。真是省了大量的工作。</p>
<h2 id="title_1-7">ms-repeat 和 ms-each 的区别<a class="anchor" href="#title_1-7">&para;</a></h2>
<p>在 Avalon 中，是先有 <code>ms-each</code> 后来才出现的 <code>ms-repeat</code> 。它们两个使用不太一样：</p>
<ul>
<li><code>ms-repeat</code> 是定义在要循环的元素上，因此，不会影响其它同级和父元素。</li>
<li><code>ms-each</code> 是定义在父元素上，但是复制的是它下面的所有子元素。因此，如果你需要   在循环时，有些子元素不参与复制就没办法了。</li>
</ul>
<p>所以目前， <code>ms-repeat</code> 是更方便的用法。</p>
<h2 id="title_1-8">观看演示代码<a class="anchor" href="#title_1-8">&para;</a></h2>
<ul>
<li><a href="../demos/comments.html" class="inner">演示代码1 demos/comments.html</a></li>
</ul>
<h2 id="title_1-9">参考文档<a class="anchor" href="#title_1-9">&para;</a></h2>
<ul>
<li><a href="http://www.cnblogs.com/rubylouvre/p/3181291.html#top19" class="outter">ms-repeat</a></li>
</ul>

        
        <div class="ui blue inverted small label">
            <i class="icon download"></i><a href="./comments.md">View Source</a>
        </div>
        
    </div>
</div>

<div class="ui page grid">
    <div class="column">
    <!-- disqus -->
    
        <div id="disqus_thread" style="margin:20px;"></div>
 <script type="text/javascript">
     /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
     var disqus_shortname = 'avalonlearning'; // required: replace example with your forum shortname

     /* * * DON'T EDIT BELOW THIS LINE * * */
     (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
 </script>
 <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
    </div>
</div>

<div class="ui page grid" id="footer">
    <div class="column">
    
<p>Designed by Limodou, Copyright 2014, Limodou</p>
<p>CSS framework <a href="https://github.com/twitter/bootstrap">Bootstrap</a>, Markdown parser lib <a href="https://github.com/limodou/par">Par</a> and this page is created by <a href="https://github.com/limodou/parm">Parm</a> tool.</p>

    </div>
</div>


<script type="text/javascript" src="./static/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="./static/semantic/javascript/semantic.min.js"></script>
<script src="./static/asset/prettify.js"></script>
<script src="./static/toc/toc.js"></script>
<script src="./static/docs.js"></script>
<script src="./static/comment.js"></script>
<script src="./static/jquery.hotkeys.js"></script>
<script src="./static/jquery.sticky-kit.min.js"></script>
<script src="./../static/jquery.cookie.js"></script>


    <script type="text/javascript">
   /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
   var disqus_shortname = 'avalonlearning'; // required: replace example with your forum shortname

   /* * * DON'T EDIT BELOW THIS LINE * * */
   (function () {
       var s = document.createElement('script'); s.async = true;
       s.type = 'text/javascript';
       s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
       (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
   }());
   </script>




    
<script type="text/javascript">
$(function(){
    var form = $('#searchform');
    form.submit(function(e){
        e.preventDefault();
        var wq=$('input[name="q"]').val();
        var link="http://www.google.com/search?q=site:limodou.github.io/avalon-learning/zh_CN "+wq;
        window.open(link);

    });
});
</script>



<script>
$(function(){
    $('.navbar .ui.dropdown').dropdown({
        on: 'hover'
    });
    $('a.language').on('click', function(){
        $.cookie('language', $(this).data('lang'), { expires: 360, path: '/' });
        window.location.href = "./../"+$(this).data('lang')+'/index.html';
    });
});
</script>
</body>
</html>
